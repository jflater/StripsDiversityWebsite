colors27 <- sequential_hcl(n_distinct(phylalist), palette = "viridis")
# I found this on stackoverflow
# It's a function that will assign a color to a specific phylum
scale_fill_phyla_consistent <- function(...){
ggplot2:::manual_scale(
'color',
values = setNames(colors27, as.character(phylalist$Phylum)),
...
)
}
abun.w <- abund_val(r.w.physeq)
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency, color = Phylum)) +
geom_point(size=3) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme_minimal() +
theme(legend.position="right")
w.a.o
abun.a <- abund_val(r.a.physeq)
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency, color = Phylum)) +
geom_point(size=3) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme_minimal() +
theme(legend.position="right")
plots <- grid.arrange(
w.a.o + scale_fill_phyla_consistent(),
a.a.o + scale_fill_phyla_consistent(),
nrow = 2,
top = "Abundance - Occupancy plots"
)
plots
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
w.d1.p <- subset_samples(physeq, experiment == "Worle_Rainfall" & depth == "1" & soil_type == "strip") %>%
filter_taxa(function(x) sum(x) > 0, T) %>%
transform_sample_counts(function(x) x/sum(x))
w.d1.p.r <- abund_val(w.d1.p)
w.d1.p.r.plot <- ggplot(w.d1.p.r, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Worle Prairie ASVs") +
theme_minimal() +
theme(legend.position="right")
b <- w.d1.p.r.plot + scale_fill_phyla_consistent()
w.d1.a <- subset_samples(physeq, experiment == "Armstrong_Rainfall" & depth == "1" & soil_type == "crop") %>%
filter_taxa(function(x) sum(x) > 0, T) %>%
transform_sample_counts(function(x) x/sum(x))
w.d1.a.r <- abund_val(w.d1.a)
w.d1.a.r.plot <- ggplot(w.d1.a.r, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Worle Ag ASVs") +
theme_minimal() +
theme(legend.position="right")
a <- w.d1.a.r.plot + scale_fill_phyla_consistent()
plots <- grid.arrange(
a,
b,
nrow = 2,
top = "Abundance - Occupancy plots"
)
plots
ggsave("images/Worle_PA_Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
colors27
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency, color = Phylum)) +
geom_point(size=3) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme_minimal() +
theme(legend.position="right") +
scale_fill_phyla_consistent()
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency, color = Phylum)) +
geom_point(size=3) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme_minimal() +
theme(legend.position="right") +
scale_fill_phyla_consistent()
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
View(phylalist)
ggplot2:::manual_scale(
'color',
values = setNames(colors27, as.character(phylalist$Phylum)),
...
)
values = setNames(colors27, as.character(phylalist$Phylum))
setNames(colors27, as.character(phylalist$Phylum))
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, color = Phylum) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme_minimal() +
theme(legend.position="right") +
scale_fill_phyla_consistent()
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, color = Phylum) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme_minimal() +
theme(legend.position="right") +
scale_fill_phyla_consistent()
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme_minimal() +
theme(legend.position="right") +
scale_fill_phyla_consistent()
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme_minimal() +
theme(legend.position="right") +
scale_fill_phyla_consistent()
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_fill_phyla_consistent()
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_fill_phyla_consistent()
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
library(RColorBrewer)
myColors <- colorRampPalette(brewer.pal(9,"Set1"))(55)
names(myColors) <- levels(phylalist$Phylum)
colScale <- scale_colour_manual(name = phylalist$Phylum, values = myColors)
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
colScale
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
colScale
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
colScale
colScale <- scale_colour_manual(myColors)
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
colScale
w.a.o
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = phylalist$Phylum, values = myColors)
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = phylalist$Phylum, values = myColors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
phylalist$Phylum
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = as.character(phylalist$Phylum), values = myColors)
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = as.character(phylalist$Phylum), values = myColors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = c(phylalist$Phylum), values = c(myColors), aesthetics = c("color"))
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = c(phylalist$Phylum), values = c(myColors), aesthetics = c("color"))
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = c(phylalist$Phylum), values = c(myColors), aesthetics = c("color"))
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
scale_colour_manual(name = c(phylalist$Phylum), values = c(myColors), aesthetics = c("color"))
c(as.character(phylalist$Phylum))
c(myColors)
names(myColors) <- levels(as.character(phylalist$Phylum))
c(myColors)
myColors
c(names(myColors))
levels((phylalist$Phylum))
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = levels(phylalist$Phylum), values = c(myColors), aesthetics = c("color"))
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_colour_manual(name = levels(phylalist$Phylum), values = c(myColors), aesthetics = c("color"))
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
myColors
c(myColors)
names(values)
### Scale color for phyla, consistent phyla colors across plots
#Function to make all phyla colors consistent
phylalist <- as.data.frame(tax_table(physeq)) %>%
select(Phylum) %>%
unique()
# this package will generate a pallette based on number and desired colors
library(colorspace)
colors27 <- sequential_hcl(n_distinct(phylalist), palette = "viridis")
# I found this on stackoverflow
# It's a function that will assign a color to a specific phylum
scale_fill_phyla_consistent <- function(...){
ggplot2:::manual_scale(
'color',
values = setNames(colors27, as.character(phylalist$Phylum)),
...
)
}
library(RColorBrewer)
myColors <- colorRampPalette(brewer.pal(9,"Set1"))(55)
names(myColors) <- levels((phylalist$Phylum))
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_fill_phyla_consistent()
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_fill_phyla_consistent()
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
cols <- c("8" = "red", "4" = "blue", "6" = "darkgreen", "10" = "orange")
names(cols)
names(myColors)
names(values)
setNames(colors27, as.character(phylalist$Phylum))
values = setNames(colors27, phylalist$Phylum)
View(phylalist)
colors <- sequential_hcl(n_distinct(phylalist), palette = "viridis") %>%
setNames(phylalist$Phylum)
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_color_manual(values = colors)
w.a.o
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_color_manual(values = colors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
a.a.o
w.a.o
phylalist
phylalist
### Scale color for phyla, consistent phyla colors across plots
#Function to make all phyla colors consistent
phylalist <- data.frame(tax_table(physeq),row.names = NULL) %>%
select(Phylum) %>%
unique()
View(phylalist)
phylalist$Phylum[is.na(phylalist$Phylum)] <- "Unclassified"
phylalist <- data.frame(tax_table(physeq),row.names = NULL) %>%
select(Phylum) %>%
unique() %>%
as.character()
phylalist$Phylum[is.na(phylalist$Phylum)] <- "Unclassified"
phylalist <- data.frame(tax_table(physeq),row.names = NULL) %>%
select(Phylum) %>%
unique()
phylalist$Phylum <- as.character(phylalist$Phylum)
phylalist$Phylum[is.na(phylalist$Phylum)] <- "Unclassified"
colors <- sequential_hcl(n_distinct(phylalist), palette = "viridis") %>%
setNames(phylalist$Phylum)
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_color_manual(values = colors)
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_color_manual(values = colors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
w.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
View(abun.w)
abun.w <- abund_val(r.w.physeq)
abun.w$Phylum <- as.character(abun.w$Phylum)
abun.w$Phylum[is.na(abun.w$Phylum)] <- "Unclassified"
abun.a <- abund_val(r.a.physeq)
abun.a$Phylum <- as.character(abun.a$Phylum)
abun.a$Phylum[is.na(abun.a$Phylum)] <- "Unclassified"
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position="right") +
scale_color_manual(values = colors)
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="right") +
scale_color_manual(values = colors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
w.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position= "none") +
scale_color_manual(values = colors)
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="Top") +
scale_color_manual(values = colors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
w.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
w.a.o <- ggplot(abun.w, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all WORLE ASVs") +
theme(legend.position= "none") +
scale_color_manual(values = colors)
a.a.o <- ggplot(abun.a, aes(x=abundance,y=frequency)) +
geom_point(size=3, aes(color = Phylum)) +
xlab("Average relative abundance (log10 scale)") +
ylab("frequency in all samples") +
labs(title="Distribution of all Armstrong ASVs") +
theme(legend.position="top") +
scale_color_manual(values = colors)
plots <- grid.arrange(
w.a.o ,
a.a.o ,
nrow = 2,
top = "Abundance - Occupancy plots"
)
a.a.o
w.a.o
ggsave("images/Core_Taxa_plot.png", plots, device = "png", dpi = 320, width = 18, height = 18, units = "in")
rmarkdown::render_site()
rmarkdown::render_site()
