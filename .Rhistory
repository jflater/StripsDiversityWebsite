colnames(sample_data(soil))
#[1] "unique_id"        "experiment"       "matrix"           "treatment"
#[5] "plot"             "sample_day"       "depth"            "in_plot_location"
#[9] "block"            "strip"            "manure_treatment" "soil_type"
sample_data(soil)$plot <- factor(sample_data(soil)$plot)
soil_nm <- subset_samples(soil, treatment == "no_manure_strip")
times <- unique(data.frame(sample_data(soil)$sample_day))
#stats based on each time point
# I removed border since it doesn't seem to be consistently strippy or croppy
# but it is often in the mix betwweenthe two, you can add it to the pcoa and look
# when the soil is dryer, it seems like the soil type makes a bigger difference, and also we see more plot by plot differences
# This can be repeated for depths 1 and 2, there are some interseting differences for depths
# depth 2 i think is more similar overall
day_list <- unique(sample_data(soil)$sample_day)
for (i in 1:length(day_list)){
baseline <- subset_samples(soil, sample_day == day_list[i] & treatment == "no_manure_strip")
baseline2 <- subset_samples(baseline, depth == "1" & soil_type != "border")
bray <- phyloseq::distance(physeq = baseline2, method = "bray")
print(day_list[i])
print(adonis(bray~soil_type+as.factor(plot), data = data.frame(sample_data(baseline2)), permutations = 999, methods = "bray"))
#print(adonis(bray~in_plot_location+as.factor(plot), data = data.frame(sample_data(baseline2)), permutations = 999, methods = "bray"))
#no significance by in plot location, this may be an interesting result
}
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[1] &treatment == "no_manure_strip" & depth == "1" & soil_type != "border")
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border")
baseline1
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border") %>%
filter_taxa(function(x) sum(x) >= 1, T)
baseline1
library(vegan)
setwd('~/Documents/StripsDiversityWebsite/')
worle <- readRDS("data/Worle_curated.RDS")
# Two baseline phyloseq, one for each depth
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border") %>%
filter_taxa(function(x) sum(x) >= 1, T)
baseline2 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "2" & soil_type != "border")  %>%
filter_taxa(function(x) sum(x) >= 1, T)
# Plot PCoA ordinations
# D1
ord1 <- ordinate(baseline1, "PCoA", "bray")
p1d1 <- plot_ordination(baseline1, ord1, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p1d1
# D2
ord2 <- ordinate(baseline2, "PCoA", "bray")
p2d2 <- plot_ordination(baseline2, ord2, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p2d2
#stats
day_list <- unique(sample_data(worle)$sample_day)
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[1] &treatment == "no_manure_strip" & depth == "1" & soil_type != "border") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
library(vegan)
setwd('~/Documents/StripsDiversityWebsite/')
worle <- readRDS("data/Worle_curated.RDS")
# Two baseline phyloseq, one for each depth
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
baseline2 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil")  %>%
filter_taxa(function(x) sum(x) >= 1, T)
# Plot PCoA ordinations
# D1
ord1 <- ordinate(baseline1, "PCoA", "bray")
p1d1 <- plot_ordination(baseline1, ord1, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p1d1
# D2
ord2 <- ordinate(baseline2, "PCoA", "bray")
p2d2 <- plot_ordination(baseline2, ord2, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p2d2
#stats
day_list <- unique(sample_data(worle)$sample_day)
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[1] & treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
day_list <- unique(sample_data(worle)$sample_day)
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[i] & treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T) # This appears to affect significance in adonis, no longer soil_type significant if mintax1...
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[i] & treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
baseline2 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil")  %>%
filter_taxa(function(x) sum(x) >= 1, T)
# Plot PCoA ordinations
# D1
ord1 <- ordinate(baseline1, "PCoA", "bray")
p1d1 <- plot_ordination(baseline1, ord1, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p1d1
# D2
ord2 <- ordinate(baseline2, "PCoA", "bray")
p2d2 <- plot_ordination(baseline2, ord2, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p2d2
#stats
#d1
day_list <- unique(sample_data(worle)$sample_day)
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[i] & treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
#d2
for (i in 1:length(day_list)){
baseline1 <- subset_samples(worle, sample_day == day_list[i] & treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
# Betadiversity measures
library(data.table)
ord <- ordinate(baseline2, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline2), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined<- merge(ord.df, sdt, by="SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC2 of strips compared to rop
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
# Betadiversity measures d1
library(data.table)
ord <- ordinate(baseline1, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline1), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined<- merge(ord.df, sdt, by="SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC2 of strips compared to rop
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
baseline2 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil")  %>%
filter_taxa(function(x) sum(x) >= 1, T)
# Plot PCoA ordinations
# D1
ord1 <- ordinate(baseline1, "PCoA", "bray")
p1d1 <- plot_ordination(baseline1, ord1, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p1d1
# D2
ord2 <- ordinate(baseline2, "PCoA", "bray")
p2d2 <- plot_ordination(baseline2, ord2, color = "soil_type") +
geom_point(size = 2) +
facet_grid(sample_day ~ plot)
p2d2
#stats
#d1
day_list <- unique(sample_data(worle)$sample_day)
for (i in 1:length(day_list)){
baseline.1 <- subset_samples(worle, sample_day == day_list[i] & treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline.1, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
#d2
for (i in 1:length(day_list)){
baseline.2 <- subset_samples(worle, sample_day == day_list[i] & treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
bray <- phyloseq::distance(physeq = baseline.2, method = "bray")
print(day_list[i])
print(adonis(bray ~ soil_type + as.factor(plot), data = data.frame(sample_data(baseline1)), permutations = 999, methods = "bray"))
}
# Betadiversity measures d1
library(data.table)
ord <- ordinate(baseline1, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline1), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined<- merge(ord.df, sdt, by="SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC2 of strips compared to rop
# Betadiversity measures d2
library(data.table)
ord <- ordinate(baseline2, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline2), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined<- merge(ord.df, sdt, by="SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC2 of strips compared to rop
library(data.table)
ord <- ordinate(baseline1, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline1), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined<- merge(ord.df, sdt, by="SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC2 of strips compared to rop
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
library(plyr)
library(data.table)
ord <- ordinate(baseline1, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline1), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined<- merge(ord.df, sdt, by="SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
#shows more distance from baseline in PC2 of strips compared to rop
#shows more distance from baseline in PC1 of strips compared to rop
# 10/19/20 Ask Adina if MEAN.1 should have called Axis.2, it had Axis.1
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
ggplot(ord.df, aes())
View(combined2)
head(combined)
worle <- readRDS("data/Worle_curated.RDS")
soil <- subset_samples(worle, matrix == c("soil"))
baseline <- subset_samples(soil, sample_day == "Baseline" & treatment == "no_manure_strip")
baseline2 <- subset_samples(baseline, depth == "1")
diagdds = phyloseq_to_deseq2(baseline2, ~ soil_type)
diagdds = DESeq(diagdds, test="Wald", fitType="parametric")
res = results(diagdds, cooksCutoff = FALSE)
install.packages(Deseq)
install.packages("Deseq")
library(Deseq)
library(Deseq2)
install.packages("DESeq2")
library(DESeq2)
?deseq2
??deseq2
?DESeq
??DESeq
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("DESeq2")
library(deseq2)
library("DESeq2")
worle <- readRDS("data/Worle_curated.RDS")
soil <- subset_samples(worle, matrix == c("soil"))
baseline <- subset_samples(soil, sample_day == "Baseline" & treatment == "no_manure_strip")
baseline2 <- subset_samples(baseline, depth == "1")
diagdds = phyloseq_to_deseq2(baseline2, ~ soil_type)
diagdds = DESeq(diagdds, test="Wald", fitType="parametric")
res = results(diagdds, cooksCutoff = FALSE)
alpha = 0.05
sigtab = res[which(res$padj < alpha), ]
sigtab = cbind(as(sigtab, "data.frame"), as(tax_table(baseline2)[rownames(sigtab), ], "matrix"))
head(sigtab)
library("ggplot2")
theme_set(theme_bw())
scale_fill_discrete <- function(palname = "Set1", ...) {
scale_fill_brewer(palette = palname, ...)
}
# Phylum order
x = tapply(sigtab$log2FoldChange, sigtab$Phylum, function(x) max(x))
x = sort(x, TRUE)
sigtab$Phylum = factor(as.character(sigtab$Phylum), levels=names(x))
# Genus order
x = tapply(sigtab$log2FoldChange, sigtab$Genus, function(x) max(x))
x = sort(x, TRUE)
sigtab$Genus = factor(as.character(sigtab$Genus), levels=names(x))
ggplot(sigtab, aes(x=Genus, y=log2FoldChange, color=Phylum)) + geom_point(size=6) +
theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust=0.5))
baseline2 <- subset_samples(baseline, depth == "2")
diagdds = phyloseq_to_deseq2(baseline2, ~ soil_type)
diagdds = DESeq(diagdds, test="Wald", fitType="parametric")
res = results(diagdds, cooksCutoff = FALSE)
alpha = 0.05
sigtab = res[which(res$padj < alpha), ]
sigtab = cbind(as(sigtab, "data.frame"), as(tax_table(baseline2)[rownames(sigtab), ], "matrix"))
head(sigtab)
library("ggplot2")
theme_set(theme_bw())
scale_fill_discrete <- function(palname = "Set1", ...) {
scale_fill_brewer(palette = palname, ...)
}
# Phylum order
x = tapply(sigtab$log2FoldChange, sigtab$Phylum, function(x) max(x))
x = sort(x, TRUE)
sigtab$Phylum = factor(as.character(sigtab$Phylum), levels=names(x))
# Genus order
x = tapply(sigtab$log2FoldChange, sigtab$Genus, function(x) max(x))
x = sort(x, TRUE)
sigtab$Genus = factor(as.character(sigtab$Genus), levels=names(x))
ggplot(sigtab, aes(x=Genus, y=log2FoldChange, color=Phylum)) + geom_point(size=6) +
theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust=0.5))
worle <- readRDS("data/Worle_curated.RDS")
soil <- subset_samples(worle, matrix == c("soil"))
baseline <- subset_samples(soil, sample_day == "Baseline" & treatment == "no_manure_strip")
baseline2 <- subset_samples(baseline, depth == "1")
diagdds = phyloseq_to_deseq2(baseline2, ~ soil_type)
diagdds = DESeq(diagdds, test="Wald", fitType="parametric")
res = results(diagdds, cooksCutoff = FALSE)
alpha = 0.05
sigtab = res[which(res$padj < alpha), ]
sigtab = cbind(as(sigtab, "data.frame"), as(tax_table(baseline2)[rownames(sigtab), ], "matrix"))
head(sigtab)
library("ggplot2")
theme_set(theme_bw())
scale_fill_discrete <- function(palname = "Set1", ...) {
scale_fill_brewer(palette = palname, ...)
}
# Phylum order
x = tapply(sigtab$log2FoldChange, sigtab$Phylum, function(x) max(x))
x = sort(x, TRUE)
sigtab$Phylum = factor(as.character(sigtab$Phylum), levels=names(x))
# Genus order
x = tapply(sigtab$log2FoldChange, sigtab$Genus, function(x) max(x))
x = sort(x, TRUE)
sigtab$Genus = factor(as.character(sigtab$Genus), levels=names(x))
ggplot(sigtab, aes(x=Genus, y=log2FoldChange, color=Phylum)) + geom_point(size=6) +
theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust=0.5))
worle <- readRDS("data/Worle_curated.RDS")
soil <- subset_samples(worle, matrix == c("soil"))
baseline <- subset_samples(soil, sample_day == "Baseline" & treatment == "no_manure_strip")
baseline2 <- subset_samples(baseline, depth == "2")
diagdds = phyloseq_to_deseq2(baseline2, ~ soil_type)
diagdds = DESeq(diagdds, test="Wald", fitType="parametric")
res = results(diagdds, cooksCutoff = FALSE)
alpha = 0.05
sigtab = res[which(res$padj < alpha), ]
sigtab = cbind(as(sigtab, "data.frame"), as(tax_table(baseline2)[rownames(sigtab), ], "matrix"))
head(sigtab)
library("ggplot2")
theme_set(theme_bw())
scale_fill_discrete <- function(palname = "Set1", ...) {
scale_fill_brewer(palette = palname, ...)
}
# Phylum order
x = tapply(sigtab$log2FoldChange, sigtab$Phylum, function(x) max(x))
x = sort(x, TRUE)
sigtab$Phylum = factor(as.character(sigtab$Phylum), levels=names(x))
# Genus order
x = tapply(sigtab$log2FoldChange, sigtab$Genus, function(x) max(x))
x = sort(x, TRUE)
sigtab$Genus = factor(as.character(sigtab$Genus), levels=names(x))
ggplot(sigtab, aes(x=Genus, y=log2FoldChange, color=Phylum)) + geom_point(size=6) +
theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust=0.5))
s <- prune_taxa(c("TACGTAGGGGGCGAGCGTTGTCCGGAGTTACTGGGCGTAAAGGGCATGCAGGCGGTCGGACGCGTTTCGGGTGACAGCGGGTGGCTTAACTACCCGAGTGGTCGAAAGACGGTTTGACTTGAGGACGCGAGAGGGACACGGAATTCCGGGTGGAGTGGTGAAATGCGTAGAGATCCGGAGGAACACCGAAGGCGAAGGCAGTGTCCTGGCGCGTAACTGACGCTGAGGTGCGAAAGCCAGGGGAGCGAACGGG"), baseline2)
plot_bar(s)
plot_bar(s, fill = soil_type)
plot_bar(s, fill = "soil_type")
worle <- readRDS("data/Worle_curated.RDS")
# Betadiversity measures d1
baseline1 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "1" & soil_type != "border" & matrix == "soil") %>%
filter_taxa(function(x) sum(x) >= 1, T)
library(data.table)
ord <- ordinate(baseline1, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline1), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined <- merge(ord.df, sdt, by = "SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits<-aes(ymin=MEAN.1-SE, ymax=MEAN.1+SE)
ggplot(combined2, aes(x=sample_day, y=MEAN.1, group = soil_type, color=soil_type))+geom_point()+geom_line()+geom_errorbar(limits, width=0)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1=mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits <- aes(ymin = MEAN.1 - SE, ymax = MEAN.1 + SE)
ggplot(combined2, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
combined3 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1 = mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits <- aes(ymin = MEAN.1 - SE, ymax = MEAN.1 + SE)
ggplot(combined3, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
# Betadiversity measures d2
library(data.table)
ord <- ordinate(baseline2, "PCoA", "bray")
baseline2 <- subset_samples(worle, treatment == "no_manure_strip" & depth == "2" & soil_type != "border" & matrix == "soil")  %>%
filter_taxa(function(x) sum(x) >= 1, T)
# Betadiversity measures d2
library(data.table)
ord <- ordinate(baseline2, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline1), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined <- merge(ord.df, sdt, by = "SampleID")
head(combined)
ord <- ordinate(baseline2, "PCoA", "bray")
ord.df <- data.table(ord$vectors, keep.rownames = TRUE)
setnames(ord.df, "rn", "SampleID")
ord.df$SampleID
ggplot(ord.df, aes())
sdt = data.table(as(sample_data(baseline2), "data.frame"),
keep.rownames = TRUE)
setnames(sdt, "rn", "SampleID")
c <- subset(sdt, soil_type == "crop")
combined <- merge(ord.df, sdt, by = "SampleID")
head(combined)
combined2 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1 = mean(Axis.1), SE = sd(Axis.1)/sqrt(length(Axis.1)))
limits <- aes(ymin = MEAN.1 - SE, ymax = MEAN.1 + SE)
ggplot(combined2, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
combined3 <- plyr::ddply(combined, .(sample_day, soil_type),summarise, MEAN.1 = mean(Axis.2), SE = sd(Axis.2)/sqrt(length(Axis.2)))
limits <- aes(ymin = MEAN.1 - SE, ymax = MEAN.1 + SE)
ggplot(combined3, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
ggplot(combined2, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
ggplot(combined3, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
ggplot(combined2, aes(x = sample_day, y = MEAN.1, group = soil_type, color = soil_type)) + geom_point() + geom_line() + geom_errorbar(limits, width = 0)
